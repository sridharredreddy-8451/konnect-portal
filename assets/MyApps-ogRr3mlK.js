import{g as R}from"./getMessageFromError-KCSW6jpt.js";import{A as x,R as ee}from"./ActionsDropdown-VWDjwXVw.js";import{P as te}from"./PageTitle-1Wd4ULQz.js";import{_ as ae,Y as ne,D as se,Q as oe,v as L}from"./MetricsProvider.vue_vue_type_script_setup_true_lang-fC0M8PHV.js";import{a as re,u as J,c as ie,d as le,_ as pe}from"./index-r-pUqtUt.js";import{u as de,c as ce}from"./useMachine-9WzNrxbV.js";import{d as ue,a as o,c as I,o as he,f as r,i as y,j as D,k as a,x as s,q as z,n as u,t as i,l as f,v as $,ah as me,ai as ge,S as fe,U as ve}from"./vue-blgNmdmJ.js";import"./CopyButton-U_ug1iko.js";import"./kongponents-T_dz3z7y.js";const ye=ue({name:"MyApps",components:{PageTitle:te,ActionsDropdown:x,RefreshTokenModal:ee,MetricsProvider:ae,MetricsConsumer:ne},setup(){const{notify:e}=ie(),l=o(""),E=o(""),F=o([]),V=o(0),N=I(()=>V.value.toString()),d=o(null),A=o(null),v=o(null),k=o(!1),S=o(null),{portalApiV2:T}=re(),M=o(!1),C=o(!0),h=J().state.helpText.myApp,c=J().state.helpText.analytics,w=o(!0),K=o({paginationPageSizes:[25,50,100],initialPageSize:25}),_=n=>{var p;return((p=n.auth_strategy)==null?void 0:p.credential_type)===le.CredentialType.ClientCredentials},H=I(()=>{var n;return`Delete ${(n=d.value)==null?void 0:n.name}`}),t=o([]),{state:m,send:g}=de(ce({predictableActionArguments:!0,id:"DeveloperMachine",initial:"idle",states:{idle:{on:{FETCH:"pending",REJECT:"error"}},pending:{on:{RESOLVE:"success",REJECT:"error"}},success:{on:{FETCH:"pending"}},error:{on:{FETCH:"pending"}}}})),O=()=>{V.value+=1},Y=async n=>{const{pageSize:p,page:P}=n,X={pageNumber:P,pageSize:p,...E.value.length&&{filterNameContains:E.value}};return g("FETCH"),T.value.service.applicationsApi.listApplications(X).then(b=>(g("RESOLVE"),t.value=b.data.data.map(Z=>Z.id),{data:b.data.data,total:b.data.meta.page.total})).catch(b=>{g("REJECT"),l.value=R(b)})},q=()=>{g("FETCH"),T.value.service.applicationsApi.deleteApplication({applicationId:d.value.id}).then(()=>{g("RESOLVE"),d.value=null,A.value=null,O(),e({message:h.deleteSuccess})}).catch(n=>{g("REJECT"),d.value=null,A.value=h.deleteFailure(R(n))})},U=n=>{g("FETCH"),v.value=null,T.value.service.credentialsApi.refreshApplicationToken({applicationId:n}).then(p=>{e({message:h.refreshSecretSuccess}),k.value=!0,S.value=p.data.client_secret}).catch(p=>{g("REJECT"),v.value=h.refreshSecretFailure(R(p))})},j=()=>{k.value=!1,S.value=null},Q=[{label:"Name",key:"name"},{label:"Description",key:"description"},{hideLabel:!0,key:"actions"}],W=n=>n.key===L.ONE_DAY?`${c.summary24Hours} ${c.summary}`:n.key===L.THIRTY_DAY?`${c.summary30Days} ${c.summary}`:c.summary,B=I(()=>{var n;return!!(t.value&&((n=t.value)!=null&&n.length))}),G=I(()=>({queryReady:B.value,additionalFilter:[{type:se.IN,dimension:oe.APPLICATION,values:t.value}]}));return he(async()=>{var n,p;w.value=!1,C.value=!0;try{(p=(n=(await T.value.service.applicationsApi.listApplicationAuthStrategies()).data)==null?void 0:n.data)!=null&&p.length&&(M.value=!0),C.value=!1}catch(P){C.value=!1,e({appearance:"danger",message:h.authStrategyFetchError(R(P))})}}),{modalTitle:H,errorMessage:l,applications:F,currentState:m,tableHeaders:Q,handleDelete:q,fetchingAuthStrategies:C,isApplicationDcr:_,deleteItem:d,deleteError:A,showSecretModal:k,hasAppAuthStrategies:M,token:S,onModalClose:j,handleRefreshSecret:U,refreshSecretError:v,searchStr:E,fetcherCacheKey:N,fetcher:Y,paginationConfig:K,helpText:h,helpTextVitals:c,analyticsCardTitle:W,vitalsLoading:w,metricProviderProps:G,myAppsReady:B}}}),Se=e=>(fe("data-v-27cc58fa"),e=e(),ve(),e),Te={width:"16",height:"16",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"mr-2"},Ce=Se(()=>u("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M16 8A8 8 0 110 8a8 8 0 0116 0zM7 5a1 1 0 012 0v2h2a1 1 0 110 2H9v2a1 1 0 11-2 0V9H5a1 1 0 110-2h2V5z",fill:"#fff","fill-opacity":".75"},null,-1)),Ae={key:1},ke={class:"summary-tier-based mb-4"},be={class:"applications-toolbar"},Ee=["onClick"],Me=["onClick"],we=["onClick"];function Pe(e,l,E,F,V,N){const d=r("KButton"),A=r("PageTitle"),v=r("KAlert"),k=r("MetricsConsumer"),S=r("KCard"),T=r("MetricsProvider"),M=r("KInput"),C=r("ActionsDropdown"),h=r("router-link"),c=r("EmptyState"),w=r("KTable"),K=r("KModal"),_=r("RefreshTokenModal"),H=r("Content");return y(),D(H,null,{default:a(()=>[s(A,{title:e.helpText.myApps,class:"mb-6"},{right:a(()=>[s(d,{"data-testid":"create-application-button",appearance:"primary",disabled:!e.hasAppAuthStrategies,"is-rounded":!1,to:{name:"create-application"}},{default:a(()=>[(y(),z("svg",Te,[u("title",null,i(e.helpText.plus),1),Ce])),f(" "+i(e.helpText.newApp),1)]),_:1},8,["disabled"])]),_:1},8,["title"]),!e.hasAppAuthStrategies&&!e.fetchingAuthStrategies?(y(),D(v,{key:0,"alert-message":e.helpText.authStrategyWarning,appearance:"warning",class:"no-auth-strategies-warning","data-testid":"no-auth-strategies-warning"},null,8,["alert-message"])):$("",!0),!e.vitalsLoading&&e.myAppsReady?(y(),z("div",Ae,[s(T,me(ge(e.metricProviderProps)),{default:a(({timeframe:t})=>[u("h2",ke,i(e.analyticsCardTitle(t)),1),s(S,{class:"mb-4 analytics-my-apps","data-testid":"analytics-metric-cards"},{body:a(()=>[s(k)]),_:1})]),_:1},16)])):$("",!0),u("div",null,[s(v,{"is-showing":!!e.deleteError,title:e.deleteError,appearance:"danger","data-testid":"delete-error-alert"},null,8,["is-showing","title"]),s(v,{"is-showing":!!e.refreshSecretError,title:e.refreshSecretError,appearance:"danger","data-testid":"refresh-error-alert"},null,8,["is-showing","title"]),s(S,null,{body:a(()=>[s(w,{"data-testid":"applications-table","fetcher-cache-key":e.fetcherCacheKey,fetcher:e.fetcher,"has-side-border":"","has-error":e.currentState.matches("error")&&!e.deleteError&&!e.refreshSecretError,"is-loading":e.currentState.matches("pending"),headers:e.tableHeaders,"is-clickable":"","is-small":"",class:"applications-table","pagination-page-sizes":e.paginationConfig.paginationPageSizes,"search-input":e.searchStr,"initial-fetcher-params":{pageSize:e.paginationConfig.initialPageSize},"onRow:click":l[1]||(l[1]=(t,m)=>e.$router.push({name:"show-application",params:{application_id:m.id}}))},{toolbar:a(({state:t})=>[u("div",be,[t.hasData||e.searchStr?(y(),D(M,{key:0,modelValue:e.searchStr,"onUpdate:modelValue":l[0]||(l[0]=m=>e.searchStr=m),placeholder:e.helpText.searchPlaceholder,type:"search"},null,8,["modelValue","placeholder"])):$("",!0)])]),name:a(({row:t})=>[f(i(t.name),1)]),actions:a(({row:t})=>[(y(),D(C,{key:t.id,"data-testid":"actions-dropdown-"+t.id},{content:a(()=>[u("div",{"data-testid":"dropdown-analytics-dashboard",class:"py-2 px-3 type-md cursor-pointer",onClick:m=>e.$router.push({name:"application-dashboard",params:{application_id:t.id}})},i(e.helpTextVitals.viewAnalytics),9,Ee),e.isApplicationDcr(t)?(y(),z("div",{key:0,"data-testid":"dropdown-refresh-application-dcr-token",class:"py-2 px-3 type-md cursor-pointer",onClick:m=>e.handleRefreshSecret(t.id)},i(e.helpText.refreshSecret),9,Me)):$("",!0),u("div",{"data-testid":"dropdown-delete-application",class:"py-2 px-3 type-md cursor-pointer delete-item",onClick:m=>e.deleteItem=t},i(e.helpText.delete),9,we)]),_:2},1032,["data-testid"]))]),"empty-state":a(()=>[s(c,{title:e.searchStr?e.helpText.noSearchResults:e.helpText.noApp},{message:a(()=>[u("p",null,[s(h,{"data-testid":"create-application-link",to:{name:"create-application"}},{default:a(()=>[f(i(e.helpText.create),1)]),_:1}),f(" "+i(e.helpText.getStarted),1)])]),_:1},8,["title"])]),"error-state":a(()=>[s(c,{"is-error":"",title:e.helpText.noApp},{message:a(()=>[u("p",null,i("Error: "+e.errorMessage),1)]),_:1},8,["title"])]),_:1},8,["fetcher-cache-key","fetcher","has-error","is-loading","headers","pagination-page-sizes","search-input","initial-fetcher-params"])]),_:1})]),s(K,{title:e.modalTitle,"is-visible":!!e.deleteItem,"action-button-text":e.helpText.delete,"action-button-appearance":"danger",class:"delete-modal","data-testid":"application-delete-modal",onCanceled:l[3]||(l[3]=t=>e.deleteItem=null)},{"header-content":a(()=>[f(i(e.modalTitle),1)]),"body-content":a(()=>[f(i(e.helpText.deleteDialog(e.deleteItem.name)),1)]),"footer-content":a(()=>[s(d,{appearance:"danger","data-testid":"application-delete-confirm-button",disabled:e.currentState.matches("pending"),icon:e.currentState.matches("pending")?"spinner":void 0,"is-rounded":!1,class:"mr-3",onClick:e.handleDelete},{default:a(()=>[f(i(e.helpText.delete),1)]),_:1},8,["disabled","icon","onClick"]),s(d,{appearance:"secondary","is-rounded":!1,onClick:l[2]||(l[2]=t=>e.deleteItem=null)},{default:a(()=>[f(i(e.helpText.cancel),1)]),_:1})]),_:1},8,["title","is-visible","action-button-text"]),s(_,{"is-visible":e.showSecretModal,token:e.token,onClosed:e.onModalClose},null,8,["is-visible","token","onClosed"])]),_:1})}const Fe=pe(ye,[["render",Pe],["__scopeId","data-v-27cc58fa"]]);export{Fe as default};
