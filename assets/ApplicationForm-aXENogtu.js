import{d as pe,a as h,D as ce,af as ue,c as I,o as me,f as b,i as M,j as G,k as d,n as f,x as o,v as w,l as p,t as s,J as fe,q,S as ve,U as he}from"./vue-blgNmdmJ.js";import{P as ge}from"./PageTitle-1Wd4ULQz.js";import{C as ye}from"./CopyButton-U_ug1iko.js";import{u as Ce,a as be,c as Se,_ as _e}from"./index-r-pUqtUt.js";import{f as Te}from"./fetchAll-gydFt7zS.js";import{u as Ee,c as Ae}from"./useMachine-9WzNrxbV.js";import"./kongponents-T_dz3z7y.js";var j,De=new Uint8Array(16);function Ie(){if(!j&&(j=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!j))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return j(De)}const Me=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ve(e){return typeof e=="string"&&Me.test(e)}var u=[];for(var z=0;z<256;++z)u.push((z+256).toString(16).substr(1));function Ke(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,m=(u[e[a+0]]+u[e[a+1]]+u[e[a+2]]+u[e[a+3]]+"-"+u[e[a+4]]+u[e[a+5]]+"-"+u[e[a+6]]+u[e[a+7]]+"-"+u[e[a+8]]+u[e[a+9]]+"-"+u[e[a+10]]+u[e[a+11]]+u[e[a+12]]+u[e[a+13]]+u[e[a+14]]+u[e[a+15]]).toLowerCase();if(!Ve(m))throw TypeError("Stringified UUID is invalid");return m}function Le(e,a,m){e=e||{};var g=e.random||(e.rng||Ie)();if(g[6]=g[6]&15|64,g[8]=g[8]&63|128,a){m=m||0;for(var T=0;T<16;++T)a[m+T]=g[T];return a}return Ke(g)}function X(e){const a={};return Object.entries(e).forEach(([m,g])=>{g&&(a[m]=g)}),a}const ke=pe({name:"ApplicationForm",components:{PageTitle:ge,CopyButton:ye},setup(){function e(t){const n={name:"",description:"",redirect_uri:"",reference_id:"",auth_strategy_id:""};return t?delete n.reference_id:delete n.redirect_uri,n}const a=Ce().state.helpText,m=h(""),g=h(""),T=h(""),H=h(""),B=h(""),V=h(!1),y=h([]),C=h(!1),_=h(null),E=h([]),S=h([]),R=h(!1),K=h(!1),D=h(!0),J=e(C.value),i=h(J),{notify:r}=Se(),L=ce(),W=ue(),{state:$,send:A}=Ee(Ae({predictableActionArguments:!0,id:"applicationFormMachine",initial:"idle",states:{idle:{on:{CLICKED_SUBMIT:"pending",FETCH:"pending",CLICKED_DELETE:"confirm_delete"}},pending:{on:{RESOLVE:"success",REJECT:"error"}},success:{on:{CLICKED_SUBMIT:"pending",CLICKED_DELETE:"confirm_delete"}},error:{on:{CLICKED_SUBMIT:"pending"}},confirm_delete:{on:{CLICKED_DELETE:"pending",CLICKED_CANCEL:"idle"}}}})),Q=I(()=>{var t;return!$.value.matches("pending")&&i.value.name.length&&(N.value!=="edit"?K.value:!0)&&(C.value||((t=i.value.reference_id)==null?void 0:t.length))}),Y=I(()=>{var t;return`Delete ${(t=i.value)==null?void 0:t.name}`}),k=I(()=>L.params.application_id),N=I(()=>k.value?"edit":"create"),Z=I(()=>N.value==="create"?le:oe),x=I(()=>({edit:$.value.matches("pending")?"Submitting":"Update",create:$.value.matches("pending")?"Submitting":"Create"})[N.value]),{portalApiV2:U}=be();me(async()=>{const t=[];k.value?t.push(se()):t.push("_"),D.value=!0,t.push(Te(n=>U.value.service.applicationsApi.listApplicationAuthStrategies(n)));try{const[n,l]=await Promise.all(t);l.length&&(K.value=!0,y.value=l.map(c=>({label:c.name,value:c.id,isDcr:c.credential_type==="client_credentials",isSelfManaged:c.credential_type==="self_managed_client_credentials",availableScopes:c.credential_type==="client_credentials"&&c.available_scopes?c.available_scopes:void 0,selected:i.value.auth_strategy_id?c.id===i.value.auth_strategy_id:c.id===L.query.auth_strategy_id||!1})));const v=l.length===1?y.value[0]:y.value.find(c=>c.selected===!0);v&&(i.value.auth_strategy_id=v.value,C.value=v.isDcr,_.value=v,R.value=v.isSelfManaged),D.value=!1}catch(n){D.value=!1,r({appearance:"danger",message:`Error fetching application auth strategies: ${n}`})}});const ee=I(()=>{var t,n;return(t=_.value.availableScopes)!=null&&t.length?(n=_.value.availableScopes)==null?void 0:n.map(l=>{var c;const v=(c=S.value)==null?void 0:c.includes(l);return{label:l,value:l,selected:v}}):[]}),ae=(t,n)=>{t(n)||r({appearance:"danger",message:a.copyButton.copyFailed.start+"id"+a.copyButton.copyFailed.end}),r({message:a.copyButton.copySucceeded.start+n+a.copyButton.copySucceeded.end})},te=t=>{if(!t)return;const n=E.value.includes(t.value);t.selected=!n},ne=t=>{const n=y.value.find(l=>l.value===t.value);_.value=n,n&&(i.value.auth_strategy_id=n.value,C.value=n.isDcr,R.value=n.isSelfManaged)},le=()=>{var t,n;A("CLICKED_SUBMIT"),m.value="",C.value?delete i.value.reference_id:delete i.value.redirect_uri,(t=_.value)!=null&&t.availableScopes?i.value.scopes=(n=E.value)!=null&&n.length?E.value:[]:i.value.scopes=void 0,U.value.service.applicationsApi.createApplication({createApplicationPayload:X(i.value)}).then(l=>{var v,c;C.value?(V.value=!0,H.value=l.data.id,B.value=l.data.name,T.value=(v=l.data.credentials)==null?void 0:v.client_id,g.value=(c=l.data.credentials)==null?void 0:c.client_secret):F(l.data.id,l.data.name,"created")}).catch(l=>P(l))},oe=()=>{var t,n;A("CLICKED_SUBMIT"),m.value="",(t=_.value)!=null&&t.availableScopes?i.value.scopes=(n=E.value)!=null&&n.length?E.value:[]:i.value.scopes=void 0,delete i.value.auth_strategy_id,U.value.service.applicationsApi.updateApplication({applicationId:k.value,updateApplicationPayload:X(i.value)}).then(l=>F(l.data.id,l.data.name,"updated")).catch(l=>P(l))},ie=()=>{m.value="",U.value.service.applicationsApi.deleteApplication({applicationId:k.value}).then(()=>F("","","deleted")).catch(t=>P(t))},se=async()=>(A("FETCH"),U.value.service.applicationsApi.getApplication({applicationId:k.value}).then(t=>{var l,v;A("RESOLVE");const n={...i.value,name:t.data.name,description:t.data.description||"",redirect_uri:t.data.redirect_uri,reference_id:t.data.reference_id,auth_strategy_id:(l=t.data.auth_strategy)==null?void 0:l.id};(v=t.data.scopes)!=null&&v.length&&(S.value=t.data.scopes),i.value=n}).catch(t=>P(t))),re=()=>{A("CLICKED_CANCEL"),V.value=!1,F(H.value,B.value,"created")},de=(t,n)=>t?L.query.product&&L.query.product_version?{name:"spec",params:{product:L.query.product,product_version:L.query.product_version},query:{application:n}}:{path:`/application/${t}`}:{path:"/my-apps"},F=(t,n,l)=>{A("RESOLVE"),r({message:`Application successfully ${l}`}),W.push(de(t,n))},P=t=>{const{data:n}=t.response,l=n.invalid_parameters&&n.invalid_parameters.length&&n.invalid_parameters||n.detail||t.detail;if(A("REJECT"),Array.isArray(l)){m.value=l.map(v=>v.reason).join(", ");return}m.value=l};return{modalTitle:Y,currentState:$,formData:i,errorMessage:m,isEnabled:Q,id:k,clientSecret:g,clientId:T,copyTokenToClipboard:ae,fetchingAuthStrategies:D,secretModalIsVisible:V,handleChangedItem:te,mappedAvailableScopes:ee,selectedScopes:E,handleAcknowledgeSecret:re,hasAppAuthStrategies:K,send:A,buttonText:x,formMode:N,formMethod:Z,handleDelete:ie,handleCancel:()=>{W.back()},generateReferenceId:()=>{i.value.reference_id=Le()},helpText:a,appAuthStrategies:y,selectedAuthStrategy:_,onChangeAuthStrategy:ne,appIsDcr:C,appIsSelfManaged:R}}}),O=e=>(ve("data-v-b35830a2"),e=e(),he(),e),we={class:"w-1/2 mx-auto"},Re={class:"text-sm mb-5"},Ue=O(()=>f("span",{class:"text-danger"},"*",-1)),Be={class:"mb-5"},$e=O(()=>f("span",{class:"text-danger"},"*",-1)),Ne={class:"mb-5"},Fe=O(()=>f("span",{class:"text-danger"},"*",-1)),Pe={key:0,class:"mb-5"},qe={key:1,class:"mb-5"},je={key:2,class:"mb-5"},Oe=O(()=>f("span",{class:"text-danger"},"*",-1)),He={class:"d-flex"},Je={class:"mb-5"},Ge={class:"flex"},ze={class:"flex-1"},We={key:0};function Xe(e,a,m,g,T,H){const B=b("PageTitle"),V=b("KAlert"),y=b("KLabel"),C=b("KInput"),_=b("KSelect"),E=b("KMultiselect"),S=b("KButton"),R=b("KTextArea"),K=b("KModal"),D=b("CopyButton"),J=b("Content");return M(),G(J,null,{default:d(()=>{var i;return[f("div",we,[o(B,{title:e.$route.meta.title,class:"mb-5"},null,8,["title"]),e.currentState.matches("error")?(M(),G(V,{key:0,appearance:"danger",class:"mb-5","alert-message":e.errorMessage},null,8,["alert-message"])):w("",!0),f("div",null,[f("p",Re,[Ue,p(" "+s(e.helpText.application.reqField),1)]),!e.hasAppAuthStrategies&&!e.fetchingAuthStrategies&&e.formMode==="create"?(M(),G(V,{key:0,"alert-message":e.helpText.application.authStrategyWarning,appearance:"warning",class:"no-auth-strategies-warning","data-testid":"no-auth-strategies-warning"},null,8,["alert-message"])):w("",!0),f("form",{onSubmit:a[6]||(a[6]=fe((...r)=>e.formMethod&&e.formMethod(...r),["prevent"]))},[f("div",Be,[o(y,{for:"applicationName"},{default:d(()=>[p(s(e.helpText.application.applicationName)+" ",1),$e]),_:1}),o(C,{id:"applicationName",modelValue:e.formData.name,"onUpdate:modelValue":a[0]||(a[0]=r=>e.formData.name=r),modelModifiers:{trim:!0},"data-testid":"application-name-input",type:"text",class:"k-input--full"},null,8,["modelValue"])]),f("div",Ne,[o(y,{for:"authStrat"},{default:d(()=>[p(s(e.helpText.application.authStrategy)+" ",1),Fe]),_:1}),o(_,{id:"authStrat",items:e.appAuthStrategies,disabled:e.formMode==="edit","data-testid":"application-auth-strategy-select",appearance:"select",width:"100%",onChange:e.onChangeAuthStrategy},null,8,["items","disabled","onChange"])]),(i=e.selectedAuthStrategy)!=null&&i.availableScopes?(M(),q("div",Pe,[o(y,{for:"availableScopes"},{default:d(()=>[p(s(e.helpText.application.availableScopes),1)]),_:1}),o(E,{id:"availableScopes",modelValue:e.selectedScopes,"onUpdate:modelValue":a[1]||(a[1]=r=>e.selectedScopes=r),"collapsed-context":"","data-testid":"available-scopes-select",class:"available-scopes-select",items:e.mappedAvailableScopes,placeholder:e.helpText.application.filterScopesPlaceholder,width:"100%",onChange:e.handleChangedItem},null,8,["modelValue","items","placeholder","onChange"])])):w("",!0),e.appIsDcr||e.appIsSelfManaged?(M(),q("div",qe,[o(y,{for:"redirectUri"},{default:d(()=>[p(s(e.helpText.application.redirectUriLabel),1)]),_:1}),o(C,{id:"redirectUri",modelValue:e.formData.redirect_uri,"onUpdate:modelValue":a[2]||(a[2]=r=>e.formData.redirect_uri=r),type:"text",class:"w-100 k-input--full"},null,8,["modelValue"])])):w("",!0),e.appIsDcr?w("",!0):(M(),q("div",je,[o(y,{for:"referenceId"},{default:d(()=>[p(s(e.helpText.application.form.referenceId.label)+" ",1),Oe]),_:1}),f("div",He,[o(C,{id:"referenceId",modelValue:e.formData.reference_id,"onUpdate:modelValue":a[3]||(a[3]=r=>e.formData.reference_id=r),"data-testid":"reference-id-input",type:"text",class:"k-input--full",placeholder:e.helpText.application.form.referenceId.placeholder,help:e.helpText.application.form.referenceId.help},null,8,["modelValue","placeholder","help"]),o(S,{class:"generate-reference-id-button","data-testid":"generate-reference-id","is-rounded":!1,appearance:"secondary",size:"small",onClick:e.generateReferenceId},{default:d(()=>[p(s(e.helpText.application.form.referenceId.generate),1)]),_:1},8,["onClick"])])])),f("div",Je,[o(y,{for:"description"},{default:d(()=>[p(s(e.helpText.application.description),1)]),_:1}),o(R,{id:"description",modelValue:e.formData.description,"onUpdate:modelValue":a[4]||(a[4]=r=>e.formData.description=r),modelModifiers:{trim:!0},rows:5,class:"k-input--full"},null,8,["modelValue"])]),f("div",Ge,[f("div",ze,[o(S,{"is-rounded":!1,type:"submit",appearance:"primary",class:"mr-4",disabled:e.isEnabled?null:!0},{default:d(()=>[p(s(e.buttonText),1)]),_:1},8,["disabled"]),o(S,{"is-rounded":!1,appearance:"secondary",onClick:e.handleCancel},{default:d(()=>[p(s(e.helpText.application.cancel),1)]),_:1},8,["onClick"])]),e.formMode==="edit"?(M(),q("div",We,[o(S,{"data-testid":"application-delete-button",appearance:"danger","is-rounded":!1,onClick:a[5]||(a[5]=r=>e.send("CLICKED_DELETE"))},{default:d(()=>[p(s(e.helpText.application.delete),1)]),_:1})])):w("",!0)])],32)])]),o(K,{title:e.modalTitle,"is-visible":e.currentState.matches("confirm_delete"),"data-testid":"application-delete-modal","action-button-text":e.helpText.application.delete,"action-button-appearance":"danger",class:"delete-modal",onCanceled:a[8]||(a[8]=r=>e.send("CLICKED_CANCEL"))},{"header-content":d(()=>[p(s(e.modalTitle),1)]),"body-content":d(()=>[p(s(e.helpText.application.confirmDelete(e.formData.name)),1)]),"footer-content":d(()=>[o(S,{"is-rounded":!1,appearance:"danger","data-testid":"application-delete-confirm-button",class:"mr-3",onClick:e.handleDelete},{default:d(()=>[p(s(e.helpText.application.delete),1)]),_:1},8,["onClick"]),o(S,{appearance:"secondary","is-rounded":!1,"data-testid":"application-delete-cancel-button",onClick:a[7]||(a[7]=r=>e.send("CLICKED_CANCEL"))},{default:d(()=>[p(s(e.helpText.application.cancel),1)]),_:1})]),_:1},8,["title","is-visible","action-button-text"]),o(K,{title:e.helpText.application.applicationCredentials,"is-visible":e.secretModalIsVisible,"data-testid":"copy-secret-modal","action-button-text":e.helpText.application.delete,"action-button-appearance":"danger",class:"application-secret-modal",onCanceled:a[9]||(a[9]=r=>e.send("CLICKED_CANCEL"))},{"header-content":d(()=>[p(s(e.helpText.application.applicationSecret),1)]),"body-content":d(()=>[p(s(e.helpText.application.headerDescription1),1),f("strong",null,s(e.formData.name),1),p(" "+s(e.helpText.application.headerDescription2),1),f("strong",null,s(e.helpText.application.headerDescription3),1),p(" "+s(e.helpText.application.headerDescription4)+" ",1),o(D,{label:e.helpText.application.clientID,"text-to-copy":e.clientId},null,8,["label","text-to-copy"]),o(D,{label:e.helpText.application.clientSecret,"text-to-copy":e.clientSecret},null,8,["label","text-to-copy"])]),"footer-content":d(()=>[o(S,{"is-rounded":!1,appearance:"primary","data-testid":"close-application-secret-modal",onClick:e.handleAcknowledgeSecret},{default:d(()=>[p(s(e.helpText.application.proceed),1)]),_:1},8,["onClick"])]),_:1},8,["title","is-visible","action-button-text"])]}),_:1})}const oa=_e(ke,[["render",Xe],["__scopeId","data-v-b35830a2"]]);export{oa as default};
